var Xcrud={config:function(a){if(xcrud_config[a]!==undefined){return xcrud_config[a]}else{return a}},lang:function(a){if(xcrud_config.lang[a]!==undefined){return xcrud_config.lang[a]}else{return a}},current_task:null,request:function(a,b,c){jQuery(document).trigger("xcrudbeforerequest",[a,b]);jQuery.ajax({type:"post",url:Xcrud.config("url"),beforeSend:function(){Xcrud.current_task=b.task;Xcrud.show_progress(a)},data:{xcrud:b},success:function(e){jQuery(a).html(e);var d=Xcrud.check_message(a);jQuery(document).trigger("xcrudafterrequest",[a,b,d]);if(c){c(a)}},complete:function(){Xcrud.hide_progress(a)},dataType:"html",cache:false})},new_window_request:function(b,d){var c=Xcrud.data2form(d);var a=window.open("","Xcrud_request","scrollbars,resizable,height=400,width=600");a.document.open();a.document.write(c);a.document.close();jQuery(a.document.body).find("form").submit()},data2form:function(b){var a='<!DOCTYPE HTML><html><head><meta http-equiv="content-type" content="text/html;charset=utf-8" /></head><body>';a+='<form method="post" action="'+Xcrud.config("url")+'">';jQuery.map(b,function(d,c){if(!jQuery.isPlainObject(d)){a+='<input type="hidden" name="xcrud['+c+']" value="'+d+'" />'}});a+="</form></body></html>";return a},unique_check:function(a,b,c){b.unique={};b.task="unique";if(jQuery(a).find(".xcrud-input[data-unique]").size()){jQuery(a).find(".xcrud-input[data-unique]").each(function(d,e){b.unique[jQuery(e).attr("name")]=jQuery(e).val()});jQuery.ajax({type:"post",url:Xcrud.config("url"),beforeSend:function(){Xcrud.show_progress(a)},data:{xcrud:b},dataType:"json",success:function(d){if(d.error){jQuery(a).find(d.error.selector).addClass("validation-error");Xcrud.show_message(a,Xcrud.lang("unique_error"),"error");return false}if(c){c(a)}},complete:function(){Xcrud.hide_progress(a)},cache:false})}else{if(c){c(a)}}},show_progress:function(a){jQuery(a).closest(".xcrud").find(".xcrud-overlay").width(jQuery(a).closest(".xcrud-container").width()).stop(true,true).fadeTo(300,0.6)},hide_progress:function(a){jQuery(a).closest(".xcrud").find(".xcrud-overlay").stop(true,true).css("display","none")},get_container:function(a){return jQuery(a).closest(".xcrud-ajax")},list_data:function(a,c){var d={};Xcrud.validation_error=0;Xcrud.save_editor_content(a);jQuery(a).find(".xcrud-data").each(function(){if(Xcrud.check_container(this,a)){d[jQuery(this).attr("name")]=Xcrud.prepare_val(this)}});if(c&&jQuery.isPlainObject(c)){jQuery.extend(d,c)}else{if(c){jQuery.extend(d,jQuery(c).data())}}d.postdata={};var b=d.task=="save"?true:false;if(b){jQuery(document).trigger("xcrudbeforevalidate",[a])}jQuery(a).find('.xcrud-input:not([type="checkbox"],[type="radio"],[disabled])').each(function(){if(Xcrud.check_container(this,a)){var g=Xcrud.prepare_val(this);d.postdata[jQuery(this).attr("name")]=g;var f=jQuery(this).data("required");var e=jQuery(this).data("pattern");if(b&&f&&!Xcrud.validation_required(g,f)){Xcrud.validation_error=1;jQuery(this).addClass("validation-error")}else{if(b&&e&&!Xcrud.validation_pattern(g,e)){Xcrud.validation_error=1;jQuery(this).addClass("validation-error")}else{jQuery(this).removeClass("validation-error")}}}});jQuery(a).find('.xcrud-input[data-type="checkboxes"]:not([disabled])').each(function(){if(d.postdata[jQuery(this).attr("name")]===undefined){d.postdata[jQuery(this).attr("name")]=""}if(Xcrud.check_container(this,a)&&jQuery(this).prop("checked")){if(!d.postdata[jQuery(this).attr("name")]){d.postdata[jQuery(this).attr("name")]=Xcrud.prepare_val(this)}else{d.postdata[jQuery(this).attr("name")]+=","+Xcrud.prepare_val(this)}}});jQuery(a).find('.xcrud-input[type="radio"]:not([disabled])').each(function(){if(Xcrud.check_container(this,a)&&jQuery(this).prop("checked")){d.postdata[jQuery(this).attr("name")]=Xcrud.prepare_val(this)}});jQuery(a).find('.xcrud-input[data-type="bool"]:not([disabled])').each(function(){if(Xcrud.check_container(this,a)){d.postdata[jQuery(this).attr("name")]=jQuery(this).prop("checked")?1:0}});jQuery(a).find(".xcrud-searchdata.xcrud-search-active").each(function(){if(Xcrud.check_container(this,a)){d[jQuery(this).attr("name")]=Xcrud.prepare_val(this)}});if(b){jQuery(document).trigger("xcrudaftervalidate",[a,d])}return d},list_controls_data:function(a,b){var c={};jQuery(a).find(".xcrud-data").each(function(){if(Xcrud.check_container(this,a)){c[jQuery(this).attr("name")]=Xcrud.prepare_val(this)}});return c},check_container:function(b,a){return jQuery(b).closest(".xcrud-ajax").attr("id")==jQuery(a).attr("id")?true:false},save_editor_content:function(a){if(jQuery(a).find(".xcrud-texteditor").size()){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}if(typeof(CKEDITOR)!="undefined"){for(instance in CKEDITOR.instances){if(jQuery("#"+instance).size()){CKEDITOR.instances[instance].updateElement()}}}}},prepare_val:function(a){switch(jQuery(a).data("type")){case"datetime":case"timestamp":case"date":case"time":if(jQuery(a).val()){var b=jQuery(a).datepicker("getDate");return b?Math.round(b.getTime()/1000)-b.getTimezoneOffset()*60:""}else{return""}break;default:return jQuery.trim(jQuery(a).val());break}},change_filter:function(e,b,c){jQuery(b).find(".xcrud-searchdata").hide().removeClass("xcrud-search-active");var a="";switch(e){case"datetime":case"timestamp":case"date":case"time":var d="date";break;case"bool":var d="bool";break;case"select":case"multiselect":case"radio":case"checkboxes":var d="dropdown";a='[data-fieldname="'+c+'"]';break;default:var d="default";break}jQuery(b).find('.xcrud-searchdata[data-fieldtype="'+d+'"]'+a).show().addClass("xcrud-search-active");if(d=="date"){Xcrud.init_datepicker_range(e,b)}},init_datepicker_range:function(c,a){jQuery(a).find(".xcrud-datepicker-from.hasDatepicker,.xcrud-datepicker-to.hasDatepicker").datepicker("destroy");var b={changeMonth:true,changeYear:true,showSecond:Xcrud.config("showseconds"),dateFormat:Xcrud.config("date_format"),timeFormat:Xcrud.config("time_format")};switch(c){case"datetime":case"timestamp":b.onClose=function(d){jQuery(a).find(".xcrud-datepicker-from").datetimepicker("option","maxDate",d)};b.onSelect=b.onClose;jQuery(a).find(".xcrud-datepicker-to").datetimepicker(b);b.maxDate=jQuery(a).find(".xcrud-datepicker-to").val();b.onClose=function(d){jQuery(a).find(".xcrud-datepicker-to").datetimepicker("option","minDate",d)};b.onSelect=b.onClose;jQuery(a).find(".xcrud-datepicker-from").datetimepicker(b);break;case"date":b.onClose=function(d){jQuery(a).find(".xcrud-datepicker-from").datepicker("option","maxDate",d)};b.onSelect=b.onClose;jQuery(a).find(".xcrud-datepicker-to").datepicker(b);b.maxDate=jQuery(a).find(".xcrud-datepicker-to").val();b.onClose=function(d){jQuery(a).find(".xcrud-datepicker-to").datepicker("option","minDate",d)};b.onSelect=b.onClose;jQuery(a).find(".xcrud-datepicker-from").datepicker(b);break;case"time":jQuery(a).find(".xcrud-datepicker-from,.xcrud-datepicker-to").timepicker(b);break}jQuery(".ui-datepicker").css("font-size","0.9em")},init_datepicker:function(a){if(jQuery(a).find(".xcrud-datepicker").size()){jQuery(a).find(".xcrud-datepicker").each(function(){var c=jQuery(this);var b=jQuery(this).data("type");switch(b){case"datetime":case"timestamp":c.datetimepicker({showSecond:Xcrud.config("showseconds"),timeFormat:Xcrud.config("time_format"),dateFormat:Xcrud.config("date_format"),firstDay:Xcrud.config("date_first_day"),changeMonth:true,changeYear:true});break;case"time":c.timepicker({showSecond:Xcrud.config("showseconds"),dateFormat:Xcrud.config("date_format"),timeFormat:Xcrud.config("time_format")});break;case"date":default:c.datepicker({dateFormat:Xcrud.config("date_format"),firstDay:Xcrud.config("date_first_day"),changeMonth:true,changeYear:true,onClose:function(g){var h=c.data("rangestart");var k=c.data("rangeend");if(h){var j=c.closest(".xcrud-ajax").find('input[name="'+h+'"]');jQuery(j).datepicker("option","maxDate",g)}if(k){var j=c.closest(".xcrud-ajax").find('input[name="'+k+'"]');jQuery(j).datepicker("option","minDate",g)}}});var d=c.data("rangestart");var f=c.data("rangeend");if(d&&c.val()){var e=c.closest(".xcrud-ajax").find('input[name="'+d+'"]');jQuery(e).datepicker("option","maxDate",c.val())}if(f&&c.val()){var e=c.closest(".xcrud-ajax").find('input[name="'+f+'"]');jQuery(e).datepicker("option","minDate",c.val())}}})}},init_texteditor:function(a){var c=[{name:"clipboard",items:["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","SpellChecker","Scayt"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"links",items:["Link","Unlink"]},{name:"insert",items:["Table","HorizontalRule","SpecialChar"]},"/",{name:"styles",items:["Format","FontSize"]},{name:"colors",items:["TextColor","BGColor"]}];var d=jQuery(a).find(".xcrud-texteditor:not(.editor-loaded)");var b=jQuery(a).find(".xcrud-texteditor-ar:not(.editor-loaded)");if(jQuery(d).size()){if(Xcrud.config("editor_url")||Xcrud.config("force_editor")){jQuery(d).addClass("editor-loaded").addClass("editor-instance");if(Xcrud.config("editor_init_url")){window.setTimeout(function(){jQuery.ajax({url:Xcrud.config("editor_init_url"),type:"get",dataType:"script",success:function(e){jQuery(".xcrud-overlay").stop(true,true).css("display","none");jQuery(d).removeClass("editor-instance")},cache:true})},300)}else{if(typeof(tinyMCE)!="undefined"){tinyMCE.init({mode:"textareas",editor_selector:"editor-instance",menubar:false,height:"150"})}else{if(typeof(CKEDITOR)!="undefined"){$(".editor-instance").each(function(){var e=$(this).attr("name");CKEDITOR.replace(e,{toolbar:c,removeDialogTabs:"table:advanced"})})}}jQuery(d).removeClass("editor-instance")}}}if(jQuery(b).size()){if(Xcrud.config("editor_url")||Xcrud.config("force_editor")){jQuery(b).addClass("editor-loaded").addClass("editor-instance-ar");if(Xcrud.config("editor_init_url")){window.setTimeout(function(){jQuery.ajax({url:Xcrud.config("editor_init_url"),type:"get",dataType:"script",success:function(e){jQuery(".xcrud-overlay").stop(true,true).css("display","none");jQuery(b).removeClass("editor-instance-ar")},cache:true})},300)}else{if(typeof(tinyMCE)!="undefined"){tinyMCE.init({mode:"textareas",editor_selector:"editor-instance-ar",content_style:"body {direction:rtl;}",menubar:false,height:"150"})}else{if(typeof(CKEDITOR)!="undefined"){$(".editor-instance-ar").each(function(){var e=$(this).attr("name");CKEDITOR.replace(e,{contentsLangDirection:"rtl",toolbar:c,removeDialogTabs:"table:advanced"})})}}jQuery(d).removeClass("editor-instance-ar")}}}},upload_file:function(c,e,a){var b=jQuery(c).closest(".xcrud-upload-container");e.field=jQuery(c).data("field");e.oldfile=jQuery(b).find(".xcrud-input").val();e.task="upload";e.type=jQuery(c).data("type");var d=Xcrud.get_extension(jQuery(c).val());if(e.type=="image"){switch(d.toLowerCase()){case"jpg":case"jpeg":case"gif":case"png":break;default:Xcrud.show_message(a,Xcrud.lang("image_type_error"),"error");jQuery(c).val("");return false;break}}jQuery(document).trigger("xcrudbeforeupload",[c,a,e]);if($(c).data("error")){return false}Xcrud.show_progress(a);jQuery.ajaxFileUpload({secureuri:false,fileElementId:jQuery(c).attr("id"),data:{xcrud:e},url:Xcrud.config("url"),success:function(h){Xcrud.hide_progress(a);jQuery(b).replaceWith(h);var f=Xcrud.check_message(a);jQuery(document).trigger("xcrudafterupload",[a,e,f]);var g=jQuery(h).find("img.xcrud-crop");if(jQuery(g).size()){Xcrud.show_crop_window(g,a)}},error:function(){Xcrud.hide_progress(a);Xcrud.show_message(a,Xcrud.lang("undefined_error"),"error")}})},show_crop_window:function(b,a){var c=jQuery(a).find("img.xcrud-crop").closest(".xcrud-upload-container");jQuery(b).dialog({resizable:false,height:"auto",width:"auto",modal:true,closeOnEscape:true,buttons:{OK:function(){var d=Xcrud.list_data(a,{task:"crop_image"});jQuery(c).find(".xrud-crop-data").each(function(){d[jQuery(this).attr("name")]=jQuery(this).val()});jQuery(document).trigger("xcrudbeforeecrop",[a,d]);Xcrud.show_progress(a);jQuery.ajax({data:{xcrud:d},success:function(e){Xcrud.hide_progress(a);jQuery(c).replaceWith(e);jQuery(document).trigger("xcrudaftercrop",[a,d])},error:function(){Xcrud.hide_progress(a);Xcrud.show_message(a,Xcrud.lang("undefined_error"),"error")},type:"post",url:Xcrud.config("url"),dataType:"html",cache:false,});jQuery(this).dialog("destroy");jQuery(".xcrud-crop").remove()}},close:function(d,f){var e=Xcrud.list_data(a,{task:"crop_image"});jQuery(c).find(".xrud-crop-data").each(function(){e[jQuery(this).attr("name")]=jQuery(this).val()});e.w=0;e.h=0;Xcrud.show_progress(a);jQuery.ajax({data:{xcrud:e},success:function(g){Xcrud.hide_progress(a);jQuery(c).replaceWith(g)},error:function(){Xcrud.hide_progress(a);Xcrud.show_message(a,Xcrud.lang("undefined_error"),"error")},type:"post",url:Xcrud.config("url"),dataType:"html",cache:false,});jQuery(this).dialog("destroy");jQuery(".xcrud-crop").remove()},open:function(d,e){Xcrud.load_image(b.attr("src"),function(p){var q=parseInt(jQuery(b).data("width"));var k=parseInt(jQuery(b).data("height"));var l=parseFloat(jQuery(b).data("ratio"));var m={};m.boxWidth=q;m.boxHeight=k;if(k>500){m.boxHeight=500;m.boxWidth=Math.round(q*500/k)}if(m.boxWidth>550){m.boxWidth=550;m.boxHeight=Math.round(k*550/q)}var f=Math.round((jQuery(window).width()-m.boxWidth-10)/2);var o=Math.round((jQuery(window).height()-m.boxHeight-75)/2);jQuery(".ui-dialog.ui-widget").css({position:"fixed",left:f+"px",top:o+"px"});m.minSize=[50,50];if(l){m.aspectRatio=l}m.onChange=Xcrud.get_coordinates;m.keySupport=false;m.trueSize=[q,k];var h=q/4;var n=k/4;var g=h*3;var j=n*3;m.setSelect=[h,n,g,j];m.allowSelect=false;jQuery(".ui-dialog img.xcrud-crop").Jcrop(m)})}})},load_image:function(b,c){var a=new Image();a.src=b;if(a.complete){if(c){c(a)}}else{jQuery(document).trigger("startload");a.onload=function(){jQuery(document).trigger("stopload");if(c){c(a)}};a.onerror=function(){jQuery(document).trigger("stopload");if(c){c(false)}}}},remove_file:function(c,d,a){var b=jQuery(c).closest(".xcrud-upload-container");d.field=jQuery(c).data("field");d.file=jQuery(b).find(".xcrud-input").val();d.task="remove_upload";Xcrud.show_progress(a);jQuery.ajax({data:{xcrud:d},success:function(e){Xcrud.hide_progress(a);jQuery(b).replaceWith(e)},type:"post",url:Xcrud.config("url"),dataType:"html",cache:false,error:function(){Xcrud.hide_progress(a);Xcrud.show_message(a,Xcrud.lang("undefined_error"),"error")}})},get_coordinates:function(a){jQuery(".xcrud").find("input.xrud-crop-data[name=x]").val(Math.round(a.x));jQuery(".xcrud").find("input.xrud-crop-data[name=y]").val(Math.round(a.y));jQuery(".xcrud").find("input.xrud-crop-data[name=x2]").val(Math.round(a.x2));jQuery(".xcrud").find("input.xrud-crop-data[name=y2]").val(Math.round(a.y2));jQuery(".xcrud").find("input.xrud-crop-data[name=w]").val(Math.round(a.w));jQuery(".xcrud").find("input.xrud-crop-data[name=h]").val(Math.round(a.h))},validation_required:function(b,a){return jQuery.trim(b).length>=a},validation_pattern:function(b,a){if(b===""){return true}switch(a){case"email":reg=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return reg.test(jQuery.trim(b));break;case"alpha":reg=/^([a-z])+$/i;return reg.test(jQuery.trim(b));break;case"alpha_numeric":reg=/^([a-z0-9])+$/i;return reg.test(jQuery.trim(b));break;case"alpha_dash":reg=/^([-a-z0-9_-])+$/i;return reg.test(jQuery.trim(b));break;case"numeric":reg=/^[\-+]?[0-9]*(\.|\,)?[0-9]+$/;return reg.test(jQuery.trim(b));break;case"integer":reg=/^[\-+]?[0-9]+$/;return reg.test(jQuery.trim(b));break;case"decimal":reg=/^[\-+]?[0-9]+(\.|\,)[0-9]+$/;return reg.test(jQuery.trim(b));break;case"point":reg=/^[\-+]?[0-9]+\.{0,1}[0-9]*\,[\-+]?[0-9]+\.{0,1}[0-9]*$/;return reg.test(jQuery.trim(b));break;case"natural":reg=/^[0-9]+$/;return reg.test(jQuery.trim(b));break;default:reg=new RegExp(a);return reg.test(jQuery.trim(b));break}return true},pattern_callback:function(d,a){var c=jQuery(a).data("pattern");if(c){var b=d.which;if(b<32||d.ctrlKey||d.altKey){return true}var f=String.fromCharCode(b);switch(c){case"alpha":reg=/^([a-z])+$/i;return reg.test(f);break;case"alpha_numeric":reg=/^([a-z0-9])+$/i;return reg.test(f);break;case"alpha_dash":reg=/^([-a-z0-9_-])+$/i;return reg.test(f);break;case"numeric":case"integer":case"decimal":case"point":reg=/^[0-9\.\,\-+]+$/;return reg.test(f);break;case"natural":reg=/^[0-9]+$/;return reg.test(f);break}}return true},validation_error:false,user_check:function(a){a()},get_extension:function(a){var b=a.split(".");return b[b.length-1]},check_fixed_buttons:function(){jQuery(".xcrud").each(function(){if(jQuery(this).find(".xcrud-list:first").width()>jQuery(this).find(".xcrud-list-container:first").width()){var a=jQuery(this).find(".xcrud-actions:not(.xcrud-fix):first").width();jQuery(this).find(".xcrud-actions:not(.xcrud-fix):first").css({width:a,"min-width":a});jQuery(this).find(".xcrud-list:first .xcrud-actions.xcrud-fix:not(.xcrud-actions-fixed)").addClass("xcrud-actions-fixed")}else{jQuery(this).find(".xcrud-list:first .xcrud-actions").removeClass("xcrud-actions-fixed")}})},block_query:{},depend_init:function(a){jQuery(a).off("change.depend");var b={};jQuery(a).find(".xcrud-input[data-depend]").each(function(){var c=Xcrud.get_container(this);var e=Xcrud.list_controls_data(c,this);var d=jQuery(this).data("depend");e.task="depend";e.name=jQuery(this).attr("name");e.value=jQuery(this).val();jQuery(c).on("change.depend",'.xcrud-input[name="'+d+'"]',function(){if(Xcrud.check_container(this,c)){e.dependval=jQuery(this).val();Xcrud.depend_query(e,d,c)}});if(d){b[d]=d}});jQuery.map(b,function(d,c){window.setTimeout(function(){jQuery(a).find('.xcrud-input[name="'+d+'"]:not([data-depend])').trigger("change.depend")},100)})},depend_query:function(c,b,a){if(Xcrud.block_query[c.name+b]){return}Xcrud.block_query[c.name+b]=1;jQuery(document).trigger("xcrudbeforedepend",[a,c]);jQuery.ajax({data:{xcrud:c},type:"post",url:Xcrud.config("url"),success:function(d){jQuery(a).find('.xcrud-input[name="'+c.name+'"]').replaceWith(d);window.setTimeout(function(){jQuery(document).trigger("xcrudafterdepend",[a,c]);jQuery(a).find('.xcrud-input[name="'+c.name+'"]').trigger("change.depend");Xcrud.block_query[c.name+b]=0},50)},cache:false})},parse_latlng:function(a){var c=a.split(",");if(c.length!=2){return null}var b=new google.maps.LatLng(parseFloat(c[0]),parseFloat(c[1]));return b},create_map:function(b,a,d,c){var f={zoom:d,center:a,mapTypeId:google.maps.MapTypeId[c]};var e=new google.maps.Map(jQuery(b)[0],f);return e},place_marker:function(e,b,a,d,f){var c=new google.maps.Marker({position:b,map:e,animation:google.maps.Animation.DROP,draggable:(a?true:false)});if(d){google.maps.event.addListener(c,"click",function(){var g=this;var h=new google.maps.InfoWindow({maxWidth:320});h.setContent('<p class="xcrud-infowinow">'+d+"</p>");h.open(e,g)})}if(a&&jQuery(f).size()){google.maps.event.addListener(c,"dragend",function(){jQuery(f).val(this.getPosition().lat()+","+this.getPosition().lng())});google.maps.event.addListener(e,"click",function(g){c.setPosition(g.latLng);jQuery(f).val(c.getPosition().lat()+","+c.getPosition().lng())})}return c},move_marker:function(e,b,a,d,c){if(b){b.setPosition(a)}else{this.place_marker(e,a,d,c)}e.setCenter(a);return b},find_point:function(a,b){return this.geocode({address:a},b)},find_address:function(a,b){return this.geocode({latLng:a},b)},geocode:function(a,d,b){var c=new google.maps.Geocoder();c.geocode(a,function(h,e){var f={};if(e==google.maps.GeocoderStatus.OK){for(var g=0;g<h.length;g++){if(h[g].formatted_address){f[g]={};f[g].lat=h[g].geometry.location.lat();f[g].lng=h[g].geometry.location.lng();f[g].address=h[g].formatted_address;if(b){return b(f[g])}}}if(d){d(f)}}})},map_instances:[],marker_instances:[],map_init:function(a){Xcrud.map_instances=[];jQuery(a).find(".xcrud-map").each(function(){var c=this;var g=jQuery(c).parent().children(".xcrud-input");var e=jQuery(c).parent().children(".xcrud-map-search");var b=Xcrud.parse_latlng(jQuery(g).val());var f=Xcrud.create_map(c,b,jQuery(c).data("zoom"),"ROADMAP");var d=Xcrud.place_marker(f,b,jQuery(c).data("draggable"),jQuery(c).data("text"),g);jQuery(g).on("keyup",function(){var h=Xcrud.parse_latlng(jQuery(g).val());Xcrud.move_marker(f,d,h,jQuery(c).data("draggable"),jQuery(c).data("text"));return false});if(jQuery(e).size()){jQuery(e).on("keyup",function(){var h=jQuery.trim(jQuery(e).val());if(h){Xcrud.find_point(h,function(j){Xcrud.map_dropdown(e,j,f,d,g,c)})}return false})}Xcrud.map_instances.push(f);Xcrud.marker_instances.push(d)})},map_dropdown:function(c,d,a,e,j,k){var b=jQuery(c).outerWidth();var f=jQuery(c).outerHeight();var h=jQuery(c).offset();jQuery(c).prev(".xcrud-map-dropdown").remove();if(d){var g='<ul class="xcrud-map-dropdown">';jQuery.map(d,function(l){g+='<li data-val="'+l.lat+","+l.lng+'">'+l.address+"</li>"});g+="</ul>";jQuery(c).before(g);jQuery(c).prev(".xcrud-map-dropdown").offset(h).css({marginTop:f+"px",minWidth:b+"px"}).children("li").on("click",function(){var l=Xcrud.parse_latlng(jQuery(this).data("val"));jQuery(c).val(jQuery(this).text());e=Xcrud.move_marker(a,e,l,jQuery(k).data("draggable"),jQuery(k).data("text"));jQuery(j).val(e.getPosition().lat()+","+e.getPosition().lng());jQuery(this).parent("ul").remove();return false})}},map_resize_all:function(){if(jQuery(".xcrud-map").size()&&Xcrud.map_instances.length){for(i=0;i<Xcrud.map_instances.length;i++){var b=Xcrud.map_instances[i];var a=Xcrud.marker_instances[i];google.maps.event.trigger(b,"resize");b.setZoom(b.getZoom());b.setCenter(a.position)}}},reload:function(a){if(!a){a="body"}jQuery(a).find(".xcrud-ajax").each(function(){Xcrud.request(this,Xcrud.list_data(this))})},bootstrap_modal:function(b,a){jQuery("#xcrud-modal-window").remove();jQuery("body").append('<div id="xcrud-modal-window" class="modal"><div class="modal-dialog"><div class="modal-content"></div></div></div>');jQuery("#xcrud-modal-window .modal-content").html('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+b+"</h4></div>");jQuery("#xcrud-modal-window .modal-content").append('<div class="modal-body">'+a+"</div>");jQuery("#xcrud-modal-window").modal();jQuery('#xcrud-modal-window [data-dismiss="modal"]').on("click",function(){jQuery("#xcrud-modal-window").modal("hide");if(jQuery(".simplemodal-close").size()){jQuery(".simplemodal-close").trigger("click");jQuery("#xcrud-modal-window").remove()}return false});jQuery("#xcrud-modal-window").on("hidden.bs.modal hidden",function(){jQuery("#xcrud-modal-window").remove()})},ui_modal:function(b,a){jQuery("#xcrud-modal-window").remove();jQuery("body").append('<div id="xcrud-modal-window">'+a+"</div>");jQuery("#xcrud-modal-window").dialog({resizable:false,height:"auto",width:"auto",modal:true,closeOnEscape:true,close:function(c,d){jQuery("#xcrud-modal-window").remove()},title:b})},modal:function(b,a){a="<span>"+a+"</span>";if(typeof(jQuery.fn.modal)!="undefined"){if(jQuery(a).first().prop("tagName")=="IMG"){Xcrud.load_image(jQuery(a).first().attr("src"),function(c){Xcrud.bootstrap_modal(b,a)})}else{Xcrud.bootstrap_modal(b,a)}}else{if(jQuery(a).first().prop("tagName")=="IMG"){Xcrud.load_image(jQuery(a).first().attr("src"),function(c){Xcrud.ui_modal(b,a)})}else{Xcrud.ui_modal(b,a)}}},init_tabs:function(a){if(jQuery(a).find(".xcrud-tabs").size()){if(typeof(jQuery.fn.tab)!="undefined"){jQuery(a).find(".xcrud-tabs > ul:first > li > a").on("click",function(){jQuery(this).tab("show");return false});jQuery(".xcrud .nav-tabs a").on("shown.bs.tab",function(b){Xcrud.map_resize_all()})}else{jQuery(a).find(".xcrud-tabs").tabs({activate:function(b,c){Xcrud.map_resize_all()}})}}},init_tooltips:function(a){if(jQuery(a).find(".xcrud-tooltip").size()){jQuery(a).find(".xcrud-tooltip").tooltip()}},show_message:function(b,e,d,c){if(b&&e){if(!d){d="info"}if(!c){c=7}var a=jQuery(b).closest(".xcrud-container");jQuery(a).children(".xcrud-message").stop(true,true).remove();jQuery(a).append('<div class="xcrud-message '+(d?d:"")+'">'+e+"</div>");jQuery(a).children(".xcrud-message").on("click",function(){jQuery(this).stop(true).slideUp(200,function(){jQuery(this).remove()})}).slideDown().delay(c*1000).slideUp(200,function(){jQuery(this).remove()})}},check_message:function(b){var a="success";var c=jQuery(b).find(".xcrud-callback-message");if(jQuery(c).size()){c.each(function(){var e=$(this);if(Xcrud.check_container(e,b)){Xcrud.show_message(b,e.val(),e.attr("name"));if(e.attr("name")!="success"){var d=e.attr("name")}e.remove()}})}return a}};jQuery(document).on("ready xcrudreinit",function(){var a=jQuery;if(a(".xcrud").size()){a(".xcrud").on("change",".xcrud-actionlist",function(){var b=Xcrud.get_container(this);var c=Xcrud.list_data(b);Xcrud.request(b,c)});a(".xcrud").on("change",".xcrud-daterange",function(){var b=Xcrud.get_container(this);if(a(this).val()){a(b).find(".xcrud-datepicker-from").datepicker("setDate",new Date((a(this).find("option:selected").data("from")+new Date().getTimezoneOffset()*60)*1000));a(b).find(".xcrud-datepicker-to").datepicker("setDate",new Date((a(this).find("option:selected").data("to")+new Date().getTimezoneOffset()*60)*1000))}else{a(b).find(".xcrud-datepicker-from,.xcrud-datepicker-to").val("")}});a(".xcrud").on("change",".xcrud-columns-select",function(){var b=Xcrud.get_container(this);var d=a(this).children("option:selected").data("type");var c=a(this).children("option:selected").val();Xcrud.change_filter(d,b,c)});a(".xcrud").on("click",".xcrud-action",function(){var b=a(this).data("confirm");if(b&&!window.confirm(b)){return}else{var c=Xcrud.get_container(this);var d=Xcrud.list_data(c,this);if(a(this).hasClass("xcrud-in-new-window")){Xcrud.new_window_request(c,d)}else{if(d.task=="save"){if(!Xcrud.validation_error){Xcrud.unique_check(c,d,function(e){d.task="save";Xcrud.request(e,d)})}else{Xcrud.show_message(c,Xcrud.lang("validation_error"),"error")}}else{Xcrud.request(c,d)}}}return false});a(".xcrud").on("click",".xcrud-toggle-show",function(){var b=a(this).closest(".xcrud").find(".xcrud-container:first");var c=a(this).hasClass("xcrud-toggle-down");if(c){a(b).stop(true,true).delay(100).slideDown(200,function(){a(document).trigger("xcrudslidedown");a(b).trigger("xcrudslidedown")});a(this).closest(".xcrud").find(".xcrud-main-tab").slideUp(200)}else{a(b).stop(true,true).slideUp(200,function(){a(document).trigger("xcrudslideup");a(b).trigger("xcrudslideup")});a(this).closest(".xcrud").find(".xcrud-main-tab").delay(100).slideDown(200)}return false});a(".xcrud").on("keypress",".xcrud-input",function(b){return Xcrud.pattern_callback(b,this)});a(".xcrud").on("click",".xcrud-search-toggle",function(){a(this).hide(200);a(this).closest(".xcrud-ajax").find(".xcrud-search").show(200);return false});a(".xcrud").on("keydown",".xcrud-searchdata",function(d){if(d.which==13){var b=Xcrud.get_container(this);var c=Xcrud.list_data(b);c.search=1;Xcrud.request(b,c);return false}});a(".xcrud").on("change",".xcrud-upload",function(){var b=Xcrud.get_container(this);var c=Xcrud.list_data(b);Xcrud.upload_file(this,c,b);return false});a(".xcrud").on("click",".xcrud-remove-file",function(){var b=Xcrud.get_container(this);var c=Xcrud.list_data(b);Xcrud.remove_file(this,c,b);return false});a(".xcrud").on("click",".xcrud_modal",function(){var b=a(this).data("content");var c=a(this).data("header");Xcrud.modal(c,b);return false});a(".xcrud-ajax").each(function(){Xcrud.init_datepicker(this);Xcrud.init_datepicker_range(a(this).find(".xcrud-columns-select option:selected").data("type"),this);Xcrud.depend_init(this);Xcrud.map_init(this);Xcrud.check_fixed_buttons();Xcrud.init_tooltips(this);Xcrud.init_tabs(this);Xcrud.check_message(this);Xcrud.hide_progress(this)})}});jQuery(window).on("resize load xcrudslidetoggle",function(){Xcrud.check_fixed_buttons()});jQuery(window).on("load",function(){jQuery(".xcrud-ajax").each(function(){Xcrud.init_texteditor(this)})});jQuery(document).on("xcrudbeforerequest",function(b,a){});jQuery(document).on("xcrudafterrequest",function(b,a){Xcrud.init_datepicker(a);Xcrud.init_texteditor(a);Xcrud.init_datepicker_range(jQuery(a).find(".xcrud-columns-select option:selected").data("type"),a);Xcrud.depend_init(a);Xcrud.map_init(a);Xcrud.check_fixed_buttons();Xcrud.init_tooltips(a);Xcrud.init_tabs(a)});jQuery.extend({print_window:function(b,a){var c={};jQuery(a).find(".xcrud-data").each(function(){c[jQuery(this).attr("name")]=jQuery(this).val()});c.task="print";jQuery.ajax({data:c,success:function(d){b.document.open();b.document.write(d);b.document.close();jQuery(a).find(".xcrud-data[name=key]:first").val(jQuery(b.document).find(".xcrud-data[name=key]:first").val());var e=navigator.userAgent.toLowerCase();if((e.indexOf("opera")!=-1)){jQuery(b).load(function(){b.print()})}else{jQuery(b).ready(function(){b.print()})}}})}});jQuery.extend({createUploadIframe:function(d,b){var a="jUploadFrame"+d;var c='<iframe id="'+a+'" name="'+a+'" style="position:absolute; top:-9999px; left:-9999px"';if(window.ActiveXObject){if(typeof b=="boolean"){c+=' src="javascript:false"'}else{if(typeof b=="string"){c+=' src="'+b+'"'}}}c+=" />";jQuery(c).appendTo(document.body);return jQuery("#"+a).get(0)},createUploadForm:function(a,j,d){var h="jUploadForm"+a;var c="jUploadFile"+a;var b=jQuery('<form  action="" method="POST" name="'+h+'" id="'+h+'" enctype="multipart/form-data"></form>');if(d){for(var e in d.xcrud){if(d.xcrud[e]=="postdata"){}else{jQuery('<input type="hidden" name="xcrud['+e+']" value="'+d.xcrud[e]+'" />').appendTo(b)}}}var f=jQuery("#"+j);var g=jQuery(f).clone();jQuery(f).attr("id",c);jQuery(f).before(g);jQuery(f).appendTo(b);jQuery(b).css("position","absolute");jQuery(b).css("top","-1200px");jQuery(b).css("left","-1200px");jQuery(b).appendTo("body");return b},ajaxFileUpload:function(n){n=jQuery.extend({},jQuery.ajaxSettings,n);var b=new Date().getTime();var c=jQuery.createUploadForm(b,n.fileElementId,(typeof(n.data)=="undefined"?false:n.data));var k=jQuery.createUploadIframe(b,n.secureuri);var j="jUploadFrame"+b;var m="jUploadForm"+b;if(n.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart")}var d=false;var g={};if(n.global){jQuery.event.trigger("ajaxSend",[g,n])}var f=function(o){var s=document.getElementById(j);try{if(s.contentWindow){g.responseText=s.contentWindow.document.body?s.contentWindow.document.body.innerHTML:null;g.responseXML=s.contentWindow.document.XMLDocument?s.contentWindow.document.XMLDocument:s.contentWindow.document}else{if(s.contentDocument){g.responseText=s.contentDocument.document.body?s.contentDocument.document.body.innerHTML:null;g.responseXML=s.contentDocument.document.XMLDocument?s.contentDocument.document.XMLDocument:s.contentDocument.document}}}catch(r){}if(g||o=="timeout"){d=true;var p;try{p=o!="timeout"?"success":"error";if(p!="error"){var q=jQuery.uploadHttpData(g,n.dataType);if(n.success){n.success(q,p)}if(n.global){jQuery.event.trigger("ajaxSuccess",[g,n])}}else{}}catch(r){p="error"}if(n.global){jQuery.event.trigger("ajaxComplete",[g,n])}if(n.global&&!--jQuery.active){jQuery.event.trigger("ajaxStop")}if(n.complete){n.complete(g,p)}jQuery(s).unbind();setTimeout(function(){try{jQuery(s).remove();jQuery(c).remove()}catch(t){}},100);g=null}};if(n.timeout>0){setTimeout(function(){if(!d){f("timeout")}},n.timeout)}try{var c=jQuery("#"+m);jQuery(c).attr("action",n.url);jQuery(c).attr("method","POST");jQuery(c).attr("target",j);if(c.encoding){jQuery(c).attr("encoding","multipart/form-data")}else{jQuery(c).attr("enctype","multipart/form-data")}jQuery(c).submit()}catch(h){}var l=0;var a=navigator.userAgent.toLowerCase();if((a.indexOf("opera")!=-1)){jQuery("#"+j).load(function(){l++;if(l==2){f()}})}else{jQuery("#"+j).on("load",f)}return{abort:function(){}}},uploadHttpData:function(r,type){data=(type=="xml"&&!type)?r.responseXML:r.responseText;if(type=="script"){jQuery.globalEval(data)}if(type=="json"){eval("data = "+data)}return data}});