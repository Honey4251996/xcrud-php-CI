var sizeInMB=function(b){var a=b.size/(1024*1024);return a.toFixed(2)};$(document).ready(function(){$(".bs-submit").on("click",function(){updateEditor();var a=$(this).closest(".bs-form");var b={};a.find(".bs-input").each(function(){b[$(this).attr("name")]=$(this).val()});$.post($(this).attr("data-url"),{task:$(this).attr("data-name"),data:b},function(c){var e=JSON.parse(c);var f=a.find(".bs-message");resetErrors(a);if(e.status=="success"){f.addClass("success")}else{f.addClass("fail");for(var d in e.report){setError(a,d,e.report[d])}}f.html(e.message);f.slideDown();setTimeout(function(){f.slideUp()},3000)})});$(".bs-message").on("click",function(){$(this).slideUp()});iniImages();iniEditor()});function iniImages(){$(".bs-select-image").click(function(){$(this).closest(".bs-file-container").find(".bs-image").click()});$(".bs-remove-image").click(function(){var a=$(this).closest(".bs-file-container").find(".bs-preview-image");$(this).closest(".bs-file-container").find(".bs-image").val("");$(this).closest(".bs-file-container").find(".image-value").val("");a.attr("src",a.attr("data-noImage"))});$(".bs-image").on("change",function(){var b=$(this);var c=$(this)[0].files[0];var a=$(this).closest(".bs-file-container");var f=parseFloat($(this).attr("data-maxsize"));if(sizeInMB(c)<=f&&(c.type=="image/jpeg"||c.type=="image/png")){var e=new FormData();e.append("image",c);e.append("task","upload_image");var d=new XMLHttpRequest();$(d).on("load",function(){var g=JSON.parse(d.responseText);if(g.status=="done"){a.find(".bs-preview-image").attr("src",b.attr("data-path")+g.file);a.find(".image-value").val(g.file)}else{if(g.status=="error"){}}});d.open("POST",$(this).attr("data-upload"));d.send(e)}else{if(sizeInMB(c)>f){console.log("File Size exceed the Limit "+f+"MB")}if(c.type!="image/jpeg"&&c.type!="image/png"){console.log("File type is not allowed")}}})}function iniEditor(){var a=[{name:"clipboard",items:["Source","Cut","Copy","Paste","PasteText","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","SpellChecker","Scayt"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"styles",items:["Styles","Format","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"tools",items:["ShowBlocks"]}];$(".bs-editor").each(function(){var b=$(this).attr("name");CKEDITOR.replace(b,{toolbar:a,height:100})})}function updateEditor(){if(typeof(CKEDITOR)!="undefined"){for(instance in CKEDITOR.instances){CKEDITOR.instances[instance].updateElement()}}}function resetErrors(a){var b=a.find(".bs-message");b.removeClass("success");b.removeClass("fail");a.find(".bs-validation-message").removeClass("success").html("");a.find(".bs-validation-message").removeClass("fail").html("");a.find(".bs-input").removeClass("bs-error")}function setError(c,a,b){c.find(".bs-validation-message."+a).addClass("fail");c.find(".bs-validation-message."+a).html(b);var d=c.find(".bs-input[name='"+a+"']");if(d.hasClass("image-value")){d.closest(".bs-file-container").addClass("bs-error")}else{if(d.hasClass("bs-editor")){d.next(".cke").addClass("bs-error")}else{d.addClass("bs-error")}}};